Metadata-Version: 2.4
Name: project-paystub-analyzer
Version: 1.0.0
Summary: Extracts tax data from paystubs, cross-verifies against W-2s, and generates a filing packet.
Author-email: Sasiekumar Shanmugam <sasiekumarshanmugam@example.com>
License: MIT
Project-URL: Homepage, https://github.com/ramuks22/project-paystub-analyzer
Project-URL: Repository, https://github.com/ramuks22/project-paystub-analyzer
Keywords: tax,ocr,pdf,paystub,finance
Classifier: Development Status :: 3 - Alpha
Classifier: Intended Audience :: End Users/Desktop
Classifier: License :: OSI Approved :: MIT License
Classifier: Programming Language :: Python :: 3
Classifier: Programming Language :: Python :: 3.10
Requires-Python: >=3.10
Description-Content-Type: text/markdown
Requires-Dist: pypdfium2>=5.4.0
Requires-Dist: streamlit>=1.42.0
Provides-Extra: dev
Requires-Dist: pytest>=7.0; extra == "dev"
Requires-Dist: pytest-mock>=3.10; extra == "dev"
Requires-Dist: mypy>=1.0; extra == "dev"
Requires-Dist: ruff>=0.1.0; extra == "dev"
Requires-Dist: types-setuptools; extra == "dev"
Requires-Dist: reportlab>=4.0; extra == "dev"
Requires-Dist: pre-commit>=3.5.0; extra == "dev"

# Paystub Analyzer (W-2 Cross-Check)

> [!WARNING]
> **Status: Alpha / Personal Workflow**
> This tool is currently in an experimental state designed for a specific personal workflow. It is **not** production-ready software.
>
> **DISCLAIMER: NOT TAX ADVICE**
> This software is for educational and data extraction purposes only. It does **not** provide tax advice.
> *   **You are responsible for the accuracy of your own tax returns.**
> *   **Always treat your W-2 as the source of truth.**
> *   The extracted data may contain errors due to OCR imperfections or heuristic failures.


This project extracts tax evidence from ADP-style paystubs, cross-verifies it against W-2 values, and generates a filing packet.

Default folders:

- Paystubs: `pay_statements`
- W-2 files: `w2_forms`

## What It Does

- Extracts from paystubs:
  - Per-paystub values (this period + YTD)
  - Annual chronological ledger across all pay dates
- Extracts from latest paystub in a tax year:
  - Gross pay (YTD)
  - Federal income tax withheld (YTD)
  - Social Security tax withheld (YTD)
  - Medicare tax withheld (YTD)
  - 401(k) contribution (YTD)
  - State income tax withheld (YTD, per state)
- Stores evidence lines used for each extracted value.
- Compares extracted values with W-2 JSON inputs and reports field-level differences.
- Runs consistency checks (duplicate pay dates, YTD decreases, this-period vs YTD delta anomalies).
- Verifies parsed YTD values against calculated YTD (`previous_ytd + this_period`) during annual runs.
- Auto-corrects high-confidence OCR state-tax YTD spikes and records them in ledger column `ytd_verification`.
- Produces a tax filing packet (JSON + Markdown + ledger CSV).
- Provides a Streamlit UI for interactive review.

## Prerequisites

1. Install dependencies:

```bash
pip install -e ".[dev]"
```

2. Ensure `tesseract` is installed and available in `PATH`.

## CLI Usage

### 1) Analyze Paystub Taxes (`paystub-analyze`)

Single file:

```bash
paystub-analyze "pay_statements/Pay Date 2025-01-15.pdf"
```

All files in folder:

```bash
paystub-analyze --default-folder pay_statements
```

JSON output:

```bash
paystub-analyze --default-folder pay_statements --json
```

### 2) Validate Against W-2 (`paystub-w2`)

Create template:

```bash
paystub-w2 \
  --write-w2-template w2_forms/w2_template_2025.json \
  --paystubs-dir pay_statements \
  --year 2025
```

Template state boxes are auto-populated from states detected in the latest paystub for that year.

Extraction-only run:

```bash
paystub-w2 --paystubs-dir pay_statements --year 2025
```

Extraction + W-2 comparison:

```bash
paystub-w2 \
  --paystubs-dir pay_statements \
  --year 2025 \
  --w2-json w2_forms/w2_2025.json
```

Extraction + W-2 **PDF** comparison (OCR):

```bash
paystub-w2 \
  --paystubs-dir pay_statements \
  --year 2025 \
  --w2-pdf w2_forms/W2_2025_Sasie_Redacted.pdf \
  --w2-render-scale 3.0
```

Outputs:

- `reports/w2_validation.md`
- `reports/w2_validation.json`

### 3) Build Annual Filing Packet (`paystub-annual`)

```bash
paystub-annual \
  --paystubs-dir pay_statements \
  --year 2025 \
  --w2-json w2_forms/w2_2025.json
```

or with W-2 PDF directly:

```bash
paystub-annual \
  --paystubs-dir pay_statements \
  --year 2025 \
  --w2-pdf w2_forms/W2_2025_Sasie_Redacted.pdf \
  --w2-render-scale 3.0
```

Outputs:

- `reports/paystub_ledger_2025.csv`
- `reports/tax_filing_package_2025.json`
- `reports/tax_filing_package_2025.md`

Ledger CSV includes `ytd_verification` to show any parsed-vs-calculated mismatches or auto-corrections detected for a row.

### 4) Convert W-2 PDF to JSON (optional)

```bash
# Note context: standalone extraction script not exposed as CLI yet, use library or add script if needed.
# For now, paystub-w2 handles this. Removing standalone script ref to avoid confusion.
```

### Tests

Run the full test suite (requires `tesseract` installed):

```bash
pytest
```

Run only unit tests (fast, no OCR):

```bash
pytest -m unit
```

Run only CLI pipeline tests:

```bash
pytest -m e2e
```

## Notes

- Extraction uses OCR heuristics to handle mixed-column PDF text.
- `gross_pay_vs_box1_informational` is intentionally informational because Box 1 and gross pay can differ due to pre-tax treatments.
- Use W-2 as filing source-of-truth; use paystub analysis for cross-verification and anomaly detection.
- `.gitignore` excludes sensitive artifacts by default (paystub PDFs, W-2 PDFs/JSON payloads, and generated reports).
